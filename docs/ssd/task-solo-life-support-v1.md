# Task: 一人暮らし支援アプリ（節約・家計管理）v1

## 変更前整理（目的 / 影響範囲 / 検証方法）
- 目的: 要件定義フェーズを完了し、Web版MVP実装フェーズへ進むための実行計画を確定する。
- 影響範囲: 実装タスク定義ドキュメントとデータモデル定義ドキュメント（コード実装は未着手）。
- 検証方法: タスクが「着手順」「完了条件」「検証方法」を満たしていることを目視確認し、差分チェックを行う。

## タスク概要
- 対象リリース: Web先行MVP（後続でAndroid/iOS展開）
- 対象機能: 家計管理（収入・支出・残高）、予算管理（締め日・カテゴリ別予算）、レシートOCR、買い物リスト自動生成、月次レポート。
- 実行方針: 2週間×3スプリントで段階実装し、各スプリントで動作可能な状態を維持する。

## マイルストーン
1. M1: Web基盤 + 家計入力の基本導線完成
2. M2: OCR / 予算管理 / 月次レポート完成
3. M3: AI在庫切れ推定 + 買い物リスト自動生成 + 結合検証完成

## 実装ステップ
### Sprint 1（基盤・家計管理）
1. Webアプリ基盤構築
   - 画面遷移、永続化、共通UIレイアウトを実装する。
2. 設計ドキュメント整備
   - データモデル定義は `docs/ssd/data-model-solo-life-support-v1.md` に分離して管理する。
   - アプリケーション構成は `docs/ssd/application-architecture-solo-life-support-v1.md` に図解付きで管理する。
   - 本タスクでは以下を実装完了条件として扱う。
     - 収入・支出・カテゴリ・予算・月次集計・買い物候補のスキーマが定義されていること。
     - 残高計算式（前月繰越 + 当月収入 - 当月支出）が単一責務で定義されていること。
     - 締め日ベースの予算期間計算ロジックが定義されていること。
     - OCR暫定値と確定データの区別構造が定義されていること。
     - 在庫推定に必要な購入履歴項目が定義されていること。
3. 家計管理機能
   - 収入/支出の登録・編集・削除とカテゴリ管理を実装する。
   - 残高の自動算出ロジックを実装する。
4. 基本テスト
   - 家計入力→一覧→残高反映までのE2E相当シナリオを確認する。

### Sprint 2（OCR・予算・レポート）
5. レシートOCR入力機能
   - レシート画像アップロード導線を家計入力画面に追加し、アップロード完了後にOCR実行状態（`queued`/`processing`/`completed`/`failed`）を表示する。
   - レシート画像から金額・日付・店舗名・カテゴリ候補（信頼度付き）を抽出し、支出入力フォームの初期値として反映する。
   - OCR結果は確定前にユーザー編集できるようにし、編集差分を監査用に保持する。
   - OCR失敗時は手入力フォームへ即時フォールバックし、画像を参照しながら入力できるUIを表示する。
   - 低信頼（例: 0.70未満）時は警告バナーと確認モーダルを表示し、手入力推奨の導線を提供する。
6. 予算管理機能
   - 予算期間の締め日設定、総額予算、カテゴリ別予算の入力・更新を実装する。
7. 月次レポート機能
   - 月次集計、カテゴリ内訳、前月比、収支差額、残高推移を表示する。

## Sprint 2: OCR統合の受け入れチェック
- [ ] レシート画像アップロード後、OCR処理開始から結果反映までの状態遷移がUIで確認できる。
- [ ] 金額・日付・店舗名・カテゴリ候補がフォーム初期値に反映され、未抽出項目は空欄扱いで編集可能である。
- [ ] ユーザーは確定前に全項目を編集でき、確定時は編集後の値が `expenses` に保存される。
- [ ] OCR失敗時はエラーメッセージと手入力誘導が表示され、入力フローが中断しない。
- [ ] 低信頼時は手入力推奨が表示され、ユーザーが手入力へ切り替えられる。
- [ ] OCR由来で確定した支出が月次集計に含まれ、手入力データと同じ計算式で集計される。

## Sprint 2: 検証シナリオ（E2E相当）
1. 正常系
   - 画像アップロード → OCR成功 → フォーム自動入力 → 一部編集 → 確定保存 → 月次レポート反映を確認する。
2. OCR失敗系
   - 意図的にOCR失敗レスポンスを返し、手入力フォームへの自動遷移と保存完了を確認する。
3. 低信頼系
   - 信頼度閾値未満のOCR結果で警告表示を確認し、手入力切替後に保存できることを確認する。

### Sprint 3（買い物リスト自動生成・結合）
8. 買い物リスト自動生成
   - 購入履歴から在庫切れを推定するAIロジックを組み込み、候補生成する。
   - 推定根拠（最終購入日・推定消費間隔）を表示し、編集・確定・保存できるようにする。
9. 結合検証
   - 受け入れ条件に対する動作確認を実施し、結果を記録する。

## 実装着手前チェックリスト
- [x] Web技術スタック（フレームワーク/状態管理/DB）を確定した（`pre-implementation-decisions-solo-life-support-v1.md`参照）
- [x] OCRプロバイダ候補と費用上限を確定した（`pre-implementation-decisions-solo-life-support-v1.md`参照）
- [x] AI在庫推定の最小モデル方針（ルール + 軽量推定）を確定した（`pre-implementation-decisions-solo-life-support-v1.md`参照）
- [ ] デモ用の初期データセットを準備した

## 検証コマンド
- `test -f docs/ssd/spec-solo-life-support-v1.md`
- `test -f docs/ssd/task-solo-life-support-v1.md`
- `test -f docs/ssd/data-model-solo-life-support-v1.md`
- `test -f docs/ssd/application-architecture-solo-life-support-v1.md`
- `git diff --check`
- `test -f docs/ssd/pre-implementation-decisions-solo-life-support-v1.md`

## 完了条件
- [ ] Sprint 1〜3の着手順と成果物が合意済み
- [ ] 実装着手前チェックリストが埋まっている
- [ ] 検証コマンド結果を記録済み
